<!doctype html>
<html lang="pt-BR">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<title>Controle de Usu√°rios - Cloud</title>
		<link rel="icon" type="image/x-icon" href="/favicon.ico">
		<link rel="stylesheet" href="style.css">
		<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
		<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
	</head>
	<body>
		<div id="loadingOverlay" class="loading-overlay" style="display: none;">
			<div class="spinner"></div>
			<p>Processando...</p>
		</div>
		<div id="toastContainer" class="toast-container"></div>

		<div class="wrap">
			<div class="topbar">
				<div class="brand">
					<h1>Controle de Acerto <span style="font-size: 10px; opacity: 0.5;">CLOUD</span></h1>
					<p class="sub">Consulta aberta | Admin trancado</p>
				</div>
				<div class="row">
					<button class="ghost" id="btnLogout" type="button" style="display:none;">
						üö™ Sair do Admin
					</button>
				</div>
			</div>

			<div class="card">
				<div class="tabs">
					<button class="tabbtn active" data-main="mainConsulta">üîé Consulta</button>
					<button class="tabbtn" data-main="mainAdmin">üîí Admin</button>
				</div>

				<div id="mainConsulta" class="tab active">
					<div class="row" style="margin-bottom:10px;">
						<div style="min-width:260px; flex:1; max-width:420px;">
							<label for="fBancoConsulta">Banco</label>
							<select id="fBancoConsulta"></select>
						</div>
						<span class="spacer"></span>
						<button class="ghost" id="btnRecarregar" type="button">üîÑ Recarregar</button>
					</div>

					<div class="tabs">
						<button class="tabbtn active" data-consulta="cTodos">üìã Todos</button>
						<button class="tabbtn" data-consulta="cBuscar">üîé Buscar</button>
						<button class="tabbtn" data-consulta="cExportar">‚¨áÔ∏è Exportar</button>
					</div>

					<div id="cTodos" class="tab active">
						<div class="tablewrap">
							<table>
								<thead>
									<tr>
										<th>Banco</th>
										<th>Data/Hora</th>
										<th>Nome</th>
										<th>CPF</th>
										<th>Tipo</th>
										<th>Motivo</th>
										<th>Arquivo</th>
										<th>Excluir</th>
									</tr>
								</thead>
								<tbody id="tbodyTodos"></tbody>
							</table>
						</div>
					</div>

					<div id="cBuscar" class="tab">
						<div class="row" style="margin-top:10px;">
							<div style="flex:1; min-width:260px;">
								<input id="q" placeholder="CPF ou nome...">
							</div>
							<button class="primary" id="btnBuscar" type="button">Buscar</button>
							<button class="ghost" id="btnLimparBusca" type="button">Limpar</button>
						</div>
						<div class="tablewrap">
							<table>
								<thead>
									<tr>
										<th>Banco</th>
										<th>Data/Hora</th>
										<th>Nome</th>
										<th>CPF</th>
										<th>Tipo</th>
										<th>Motivo</th>
										<th>Arquivo</th>
										<th>Excluir</th>
									</tr>
								</thead>
								<tbody id="tbodyBusca"></tbody>
							</table>
						</div>
					</div>

					<div id="cExportar" class="tab">
						<div class="row" style="margin-top:10px;">
							<button class="primary" id="btnExportarConsulta" type="button">‚¨áÔ∏è Baixar CSV</button>
						</div>
					</div>
				</div>

				<div id="mainAdmin" class="tab">
					<div class="adminHead">
						<div class="adminTabsWrap">
							<button class="tabbtn active" data-admin="aCadastrar">üìù Cadastrar</button>
							<button class="tabbtn" data-admin="aVendedores">üë• Vendedores</button>
							<button class="tabbtn" data-admin="aFrases">üí¨ Frases</button>
							<button class="tabbtn" data-admin="aHistorico">üìö Hist√≥rico</button>
							<button class="tabbtn" data-admin="aReclamacoes">üì£ Reclama√ß√µes</button>
							<button class="tabbtn" data-admin="aAnalise">üìä An√°lise</button>
						</div>
					</div>

					<div id="aCadastrar" class="tab active" style="margin-top:12px;">
						<div class="section">
							<h3>Novo Registro</h3>
							<div style="display:grid; gap:12px; grid-template-columns:1fr 1fr;">
								<div>
									<label>Banco</label>
									<select id="banco"></select>
								</div>
								<div>
									<label>Tipo</label>
									<select id="tipo">
										<option value="BLOQUEIO">Bloqueio</option>
										<option value="INATIVACAO">Inativa√ß√£o</option>
									</select>
								</div>
								<div>
									<label>CPF</label>
									<input id="cpf" maxlength="14" placeholder="000.000.000-00">
								</div>
								<div>
									<label>Nome</label>
									<input id="nome" placeholder="Auto-preenchimento">
								</div>
								<div style="grid-column: 1/-1;">
									<label>Frase Padr√£o</label>
									<select id="motivoPadrao"></select>
								</div>
								<div style="grid-column: 1/-1;">
									<label>Complemento / Opcional</label>
									<textarea id="motivo" placeholder="Descreva o motivo..."></textarea>
								</div>
							</div>
							<div style="margin-top: 12px;">
								<label>Anexo (Opcional)</label>
								<input type="file" id="arquivoInput">
							</div>
							<div class="row" style="margin-top:15px;">
								<button class="primary" id="btnSalvar">‚úÖ Salvar na Nuvem</button>
								<button id="btnLimpar">Limpar</button>
							</div>
						</div>
					</div>

					<div id="aVendedores" class="tab" style="margin-top:12px;">
						<div class="section">
							<h3>Gest√£o da Base de Vendedores</h3>
							<div class="adminActions" style="margin-bottom: 15px;">
								<label class="filebtn" style="margin-bottom: 0px;">
									<input id="bases" type="file" multiple accept=".xlsx,.xls,.csv">
									<button type="button" class="primary" id="btnCarregarBase">
										üì• Carregar Planilha
									</button>
								</label>
								<button class="ghost" id="btnModeloBase">‚¨áÔ∏è Baixar Modelo</button>
								<button class="ghost" id="btnLimparBase" style="color: #ff4d6d;">
									üóëÔ∏è Apagar Tudo
								</button>
							</div>
							<div class="tablewrap" style="max-height: 400px;">
								<table>
									<thead>
										<tr>
											<th>CPF</th>
											<th>Nome Completo</th>
											<th>A√ß√£o</th>
										</tr>
									</thead>
									<tbody id="tbodyBaseVendedores"></tbody>
								</table>
							</div>
						</div>
					</div>

					<div id="aFrases" class="tab" style="margin-top:12px;">
						<div class="section">
							<h3>Gest√£o de Frases Padr√£o</h3>
							<div class="row">
								<input id="motivoNovo" placeholder="Nova frase..." style="flex: 1;">
								<button class="primary" id="btnSalvarFrase">‚ûï Adicionar</button>
							</div>
							<div class="tablewrap" style="margin-top: 20px;">
								<div id="listaFrases" style="padding: 10px;"></div>
							</div>
						</div>
					</div>

					<div id="aHistorico" class="tab" style="margin-top:12px;">
						<div class="section">
							<h3>Hist√≥rico Administrativo</h3>
							<div class="tablewrap">
								<table>
									<thead>
										<tr>
											<th>Banco</th>
											<th>Data/Hora</th>
											<th>Nome</th>
											<th>CPF</th>
											<th>Tipo</th>
											<th>Motivo</th>
											<th>Arq</th>
											<th>A√ß√£o</th>
										</tr>
									</thead>
									<tbody id="tbodyHistorico"></tbody>
								</table>
							</div>
						</div>
					</div>

					<div id="aReclamacoes" class="tab" style="margin-top:12px;">
						<div class="section">
							<h3>Registrar Reclama√ß√£o</h3>
							<div style="display:grid; gap:12px; grid-template-columns:1fr 1fr;">
								<div>
									<label>Banco</label>
									<select id="recBanco"></select>
								</div>
								<div>
									<label>CPF</label>
									<input id="recCpf" maxlength="14">
								</div>
								<div style="grid-column: 1 / -1;">
									<label>Nome</label>
									<input id="recNome">
								</div>
								<div style="grid-column: 1 / -1;">
									<label>Descri√ß√£o</label>
									<textarea id="recDesc"></textarea>
								</div>
							</div>
							<div class="row" style="margin-top:12px;">
								<button class="primary" id="btnSalvarRec">Salvar</button>
								<button class="ghost" id="btnLimparRec">Limpar</button>
							</div>
							<div class="divider"></div>
							<div class="row">
								<h3>Lista Reclama√ß√µes</h3>
								<span class="spacer"></span>
								<div style="min-width:200px;">
									<select id="fBancoRec"></select>
								</div>
								<div style="min-width:200px;">
									<input id="buscaRec" placeholder="Filtrar...">
								</div>
							</div>
							<div class="tablewrap">
								<table>
									<thead>
										<tr>
											<th>Banco</th>
											<th>Data</th>
											<th>Vendedor</th>
											<th>CPF</th>
											<th>Descri√ß√£o</th>
											<th>A√ß√£o</th>
										</tr>
									</thead>
									<tbody id="tbodyRec"></tbody>
								</table>
							</div>
						</div>
					</div>

					<div id="aAnalise" class="tab" style="margin-top:12px;">
						<div class="section">
							<div class="row" style="margin-bottom:10px;">
								<div style="min-width:240px; flex:1;">
									<label>Banco</label>
									<select id="fBancoAnalise"></select>
								</div>
								<div style="flex:1;">
									<label>Buscar</label>
									<input id="buscaAnalise" placeholder="CPF ou nome...">
								</div>
								<button class="smallbtn ghost" id="btnExportarAnalise">‚¨áÔ∏è CSV (An√°lise)</button>
							</div>
							<div
								id="alertSugerido"
								class="panel"
								style="display:none; border-color: #ff4d6d; background: rgba(255,77,109,0.1); margin-bottom: 15px;"
							>
								<span class="badge suggest">‚õî Bloqueio sugerido</span><span
									class="sub"
									id="alertSugeridoTxt"
								></span>
							</div>
							<div class="divider"></div>
							<div class="twoCols">
								<div>
									<div class="tablewrap" style="max-height:520px;">
										<table>
											<thead>
												<tr>
													<th>Vendedor</th>
													<th>CPF</th>
													<th>Total</th>
													<th>Status</th>
													<th>A√ß√µes</th>
												</tr>
											</thead>
											<tbody id="tbodyAnalise"></tbody>
										</table>
									</div>
								</div>
								<div>
									<div
										id="detPanel"
										style="margin-bottom:10px; padding:10px; border-radius:8px; background:rgba(255,255,255,0.05); border:1px solid rgba(255,255,255,0.1);"
									>
										<div class="sub">Clique em <b>Ver</b>.</div>
									</div>
									<div class="tablewrap" style="max-height:420px;">
										<table>
											<thead>
												<tr>
													<th>Banco</th>
													<th>Data</th>
													<th>Descri√ß√£o</th>
												</tr>
											</thead>
											<tbody id="tbodyDet"></tbody>
										</table>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>

		<div id="loginBack" class="modal-overlay" style="display: none;">
			<div class="card login-card">
				<h2>üîí Acesso Restrito</h2>
				<label>Usu√°rio</label>
				<input id="loginUser">
				<label>Senha</label>
				<input id="loginPass" type="password">
				<button class="primary" id="btnEntrar">Entrar</button>
				<button class="ghost" id="btnCancelLogin">Cancelar</button>
			</div>
		</div>
		<script type="module" src="main.js"></script>
	</body>
</html>
